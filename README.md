# Minecraft Skins üéÆ

[![.NET](https://img.shields.io/badge/.NET-8.0-512BD4)](https://dotnet.microsoft.com/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-336791)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-‚úì-2496ED)](https://www.docker.com/)
[![Tests](https://img.shields.io/badge/Tests-‚úì-success)](https://github.com/fairwix/MinecraftSkins)

–ú–∞–≥–∞–∑–∏–Ω Minecraft —Å–∫–∏–Ω–æ–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫—É—Ä—Å–∞ BTC/USD. 
–¶–µ–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏.

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã](#-—Ñ–æ—Ä–º—É–ª–∞-—Ä–∞—Å—á—ë—Ç–∞-—Ü–µ–Ω—ã)
- [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#-–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
- [API Endpoints](#-api-endpoints)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì¶ **–ö–∞—Ç–∞–ª–æ–≥ —Å–∫–∏–Ω–æ–≤** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
- üí∞ **BTC-—Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã –æ—Ç –∫—É—Ä—Å–∞ Bitcoin
- üõí **–ü–æ–∫—É–ø–∫–∞** ‚Äî —Å –∑–∞–ø–∏—Å—å—é –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ñ–∏–∫—Å–∞—Ü–∏–µ–π –∫—É—Ä—Å–∞
- üìú **–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- üíæ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞** ‚Äî —Å fallback-–º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- üîí **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫
- üè∑ **Soft delete** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∫–∏–Ω–æ–≤

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **.NET 8** + ASP.NET Core Web API
- **Entity Framework Core** + PostgreSQL
- **FluentValidation** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO
- **AutoMapper** ‚Äî –º–∞–ø–ø–∏–Ω–≥ —Å—É—â–Ω–æ—Å—Ç–µ–π
- **IMemoryCache** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ BTC

### Frontend
- **HTML5**, **CSS3**, **JavaScript** (vanilla)
- **Bootstrap 5** ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞
- **Font Awesome 6** ‚Äî –∏–∫–æ–Ω–∫–∏

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker** + **Docker Compose**
- **PostgreSQL 15** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Nginx** ‚Äî —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **Health Checks** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **xUnit** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Moq** ‚Äî –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **FluentAssertions** ‚Äî —á–∏—Ç–∞–µ–º—ã–µ assertions
- **ReportGenerator** ‚Äî –æ—Ç—á—ë—Ç—ã –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ 4 —Å–ª–æ—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

```
MinecraftSkins/
‚îú‚îÄ‚îÄ MinecraftSkins.Domain/          # –°—É—â–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ MinecraftSkins.Application/      # Use cases, DTO, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ MinecraftSkins.Infrastructure/   # EF Core, –≤–Ω–µ—à–Ω–∏–µ API, –∫—ç—à
‚îú‚îÄ‚îÄ MinecraftSkins.WebAPI/           # API, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, middleware
‚îú‚îÄ‚îÄ MinecraftSkins.Tests/            # Unit-—Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ frontend/                        # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

### –°–ª–æ–∏ –ø–æ–¥—Ä–æ–±–Ω–æ:

**Domain** ‚Äî —è–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `Skin` ‚Äî —Å—É—â–Ω–æ—Å—Ç—å —Å–∫–∏–Ω–∞ (Id, Name, BasePriceUsd, IsAvailable)
- `Purchase` ‚Äî —á–µ–∫ –ø–æ–∫—É–ø–∫–∏ (Id, SkinId, PriceUsdFinal, BtcUsdRate, RateSource)

**Application** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- DTO –∏ –º–∞–ø–ø–∏–Ω–≥–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ FluentValidation
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã —Ü–µ–Ω—ã (Standard/Promo)

**Infrastructure** ‚Äî –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- EF Core DbContext –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è CoinGecko API
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

**WebAPI** ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞:
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (—Ç–æ–Ω–∫–∏–µ)
- Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- Health Checks

## üßÆ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã

```
FinalPrice = BasePriceUsd √ó (1 + BTC_USD_Rate √∑ 50000)
```

- –¶–µ–Ω–∞ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ **2 –∑–Ω–∞–∫–æ–≤** –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- –ü—Ä–∏ BTC = $50,000 —Ü–µ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞
- –ü—Ä–∏ BTC = $0 —Ü–µ–Ω–∞ —Ä–∞–≤–Ω–∞ –±–∞–∑–æ–≤–æ–π

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–≤–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:
- **StandardPriceCalculator** ‚Äî –±–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞
- **PromoPriceCalculator** ‚Äî —Å–æ —Å–∫–∏–¥–∫–æ–π 10% (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏)

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/fairwix/MinecraftSkins.git
cd MinecraftSkins

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up --build
```

**–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
- Frontend: http://localhost:8080
- Backend API: http://localhost:5001
- Swagger UI: http://localhost:5001/swagger
- Health Check: http://localhost:5001/health

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
docker-compose down
```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- .NET 8 SDK
- PostgreSQL 15
- –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ appsettings.Development.json
# {
#   "ConnectionStrings": {
#     "DefaultConnection": "Host=localhost;Port=5432;Database=minecraftskins;Username=postgres;Password=postgres"
#   }
# }

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
dotnet ef database update -p MinecraftSkins.Infrastructure -s MinecraftSkins.WebAPI

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend
cd MinecraftSkins.WebAPI
dotnet run
# Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:5131

# 4. –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd ../frontend
# –í–∞—Ä–∏–∞–Ω—Ç 1: –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open index.html
# –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ Python
python3 -m http.server 8080
# Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080
```

## üìö API Endpoints

### Skins
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|--------|----------|----------|-----------|
| GET | `/api/skins` | –°–ø–∏—Å–æ–∫ —Å–∫–∏–Ω–æ–≤ | `availableOnly`, `search`, `skip`, `take` |
| GET | `/api/skins/{id}` | –î–µ—Ç–∞–ª–∏ —Å–∫–∏–Ω–∞ | ‚Äî |
| POST | `/api/skins` | –°–æ–∑–¥–∞—Ç—å —Å–∫–∏–Ω | `{ name, basePriceUsd, isAvailable }` |
| PUT | `/api/skins/{id}` | –û–±–Ω–æ–≤–∏—Ç—å —Å–∫–∏–Ω | `{ name, basePriceUsd, isAvailable }` |
| DELETE | `/api/skins/{id}` | –£–¥–∞–ª–∏—Ç—å —Å–∫–∏–Ω (soft delete) | ‚Äî |

### Rates
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –û—Ç–≤–µ—Ç |
|--------|----------|----------|-------|
| GET | `/api/rates/btc-usd` | –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å BTC/USD | `{ rate, asOfUtc, source, ageSeconds }` |

### Purchases
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ |
|--------|----------|----------|-----------|
| POST | `/api/purchases` | –ö—É–ø–∏—Ç—å —Å–∫–∏–Ω | `X-User-Id`, `Idempotency-Key` |
| GET | `/api/purchases` | –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ | `mineOnly`, `skinId`, `from`, `to`, `skip`, `take` |
| GET | `/api/purchases/{id}` | –î–µ—Ç–∞–ª–∏ –ø–æ–∫—É–ø–∫–∏ | ‚Äî |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–§–æ–∫—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–¥–µ–ª–∞–Ω –Ω–∞ **–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ (Application + Domain)**, —Ç–∞–∫ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### ‚úÖ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

**Domain Layer (100%):**
- –°—É—â–Ω–æ—Å—Ç–∏ `Skin` –∏ `Purchase` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Å–≤–æ–π—Å—Ç–≤–∞

**Application Layer (92%):**
- ‚úÖ **IPriceCalculator** ‚Äî Standard –∏ Promo —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ **PurchaseService** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, optimistic concurrency
- ‚úÖ **SkinService** ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, soft delete, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ **FluentValidation** ‚Äî –≤—Å–µ DTO (Create/Update Skin, Create Purchase)
- ‚úÖ **AutoMapper** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –º–∞–ø–ø–∏–Ω–≥–æ–≤
- ‚úÖ **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** ‚Äî SkinUnavailableException, ExternalServiceUnavailableException

**Infrastructure Layer (–≤—ã–±–æ—Ä–æ—á–Ω–æ):**
- ‚úÖ **BtcRateService** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
- ‚úÖ **DbContext –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π, –∏–Ω–¥–µ–∫—Å—ã, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ SeedData –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∫–æ–¥)

**WebAPI Layer (–≤—ã–±–æ—Ä–æ—á–Ω–æ):**
- ‚úÖ **ExceptionHandlingMiddleware** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (400, 404, 409, 503)
- ‚úÖ **HealthChecks** ‚Äî DatabaseHealthCheck, BtcRateHealthCheck
- ‚ö†Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ ‚Äî –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –∏ –Ω–µ –∏–º–µ—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### üéØ –ü–æ—á–µ–º—É —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥?

> **"–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–Ω–∫–∏–º–∏"** ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. 
> 
> –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ Application –∏ Domain —Å–ª–æ–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –≤—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏. 
> –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–∑—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—Ç–≤–µ—Ç—ã ‚Äî —Ç–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ 
> —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–±—à–∏—Ä–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

### üîç –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

```csharp
// –¢–µ—Å—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ü–µ–Ω—ã
[Theory]
[InlineData(10, 50000, 20)]
[InlineData(20, 25000, 30)]
public void CalculateFinalPrice_ShouldReturnExpected(decimal basePrice, decimal btcRate, decimal expected)
{
    var result = _calculator.CalculateFinalPrice(basePrice, btcRate);
    result.Should().Be(expected);
}

// –¢–µ—Å—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∫–∏
[Fact]
public async Task CreatePurchaseAsync_WithSameIdempotencyKey_ReturnsExistingPurchase()
{
    // Arrange
    var key = "test-key";
    var firstPurchase = await _service.CreatePurchaseAsync(skinId, userId, btcRate, key);
    
    // Act
    var secondPurchase = await _service.CreatePurchaseAsync(skinId, userId, btcRate, key);
    
    // Assert
    secondPurchase.Id.Should().Be(firstPurchase.Id);
}
```

### üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
dotnet test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
dotnet test -v normal

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
dotnet test MinecraftSkins.Tests

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
dotnet test --collect:"XPlat Code Coverage"

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å HTML-–æ—Ç—á—ë—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
dotnet tool install -g dotnet-reportgenerator-globaltool
reportgenerator -reports:"**/coverage.cobertura.xml" -targetdir:"coveragereport" -reporttypes:Html
# –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á—ë—Ç: open coveragereport/index.html
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Health Check**: http://localhost:5001/health
- **–î–µ—Ç–∞–ª—å–Ω—ã–π Health Check**: http://localhost:5001/health/detailed
- **Swagger**: http://localhost:5001/swagger
- **–õ–æ–≥–∏**: `docker-compose logs -f`

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å

- **Idempotency-Key** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î)
- **RowVersion** ‚Äî optimistic concurrency –¥–ª—è —Å–∫–∏–Ω–æ–≤
- **Soft delete** ‚Äî —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º –≤ EF Core
- **X-User-Id** ‚Äî –º–æ–∫-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–µ–º–æ
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫—É–ø–∫–∏

## ‚ö° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–Ω–µ—à–Ω–µ–µ API (CoinGecko)
- ‚úÖ HttpClientFactory —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
- ‚úÖ –¢–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–µ—Ç–µ–≤—ã–µ, JSON, —Å—Ç–∞—Ç—É—Å—ã)
- ‚úÖ Rate limit –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ BTC
- ‚úÖ IMemoryCache —Å TTL 60 —Å–µ–∫—É–Ω–¥
- ‚úÖ Fallback –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (10 –º–∏–Ω—É—Ç)
- ‚úÖ –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–≤–µ–∂–µ–≥–æ fallback ‚Üí 503 Service Unavailable
- ‚úÖ Endpoint /api/rates/btc-usd —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (source, age)

### EF Core
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ Seeding –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤
- ‚úÖ AsNoTracking –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è soft delete
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ middleware
- ‚úÖ ProblemDetails (RFC 7807)
- ‚úÖ 400 ‚Äî Validation errors
- ‚úÖ 404 ‚Äî Not found
- ‚úÖ 409 ‚Äî Skin unavailable
- ‚úÖ 503 ‚Äî External service unavailable

## üìà –ü–ª–∞–Ω—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

- [ ] **Redis** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞
- [ ] **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî –≤–º–µ—Å—Ç–æ –º–æ–∫-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** ‚Äî —Å TestContainers
- [ ] **–ú–µ—Ç—Ä–∏–∫–∏** ‚Äî Prometheus + Grafana
- [ ] **CI/CD** ‚Äî GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] **SignalR** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**fairwix**  
GitHub: [@fairwix](https://github.com/fairwix)

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **CoinGecko** ‚Äî –∑–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏ –Ω–∞–¥—ë–∂–Ω–æ–µ API –∫—É—Ä—Å–æ–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- **Microsoft** ‚Äî –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π .NET 8 –∏ ASP.NET Core
- **Open source —Å–æ–æ–±—â–µ—Å—Ç–≤–æ** ‚Äî –∑–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –¥–µ–ª–∞—é—â–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ª—É—á—à–µ

---

‚≠ê **–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–∫–∞–∑–∞–ª—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É –Ω–∞ GitHub!**  
üêõ **–ù–∞—à–ª–∏ –±–∞–≥? –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!**
